{% extends "base.html" %}

{% block content %}
    <!-- script, which connect assigned and available SelectMultipleFields -->
    <script type="text/javascript">
        function assign_object() {
            return !$('#houses_available option:selected').remove().appendTo('#houses_assigned');
        };

        function unassign_object() {
            return !$('#houses_assigned option:selected').remove().appendTo('#houses_available');
        };

        $(document).ready( function() {
            $('#houses_available').dblclick( assign_object );
            $('#houses_assigned').dblclick( unassign_object );
        });

        function elem_expand(el_id) {
            var x = document.getElementById(el_id);
            if (x.style.display === "none") {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
        };
    </script>

    <div class="wrapper">
        <div class="announcement-form d-flex">
            <form class="announcement-form" action="" method="post">

                {{ form.hidden_tag() }}
                {{ form.csrf_token }}

                <div class="form-group">
                   {{ form.announcement_category.label }}
                   {{ form.announcement_category(class="form-control-lg form-control") }}
                </div>

                <div class="form-group">
                    {{ form.title.label }}
                    {{ form.title(class="form-control-lg form-control") }}
                </div>

                {{ form.post_date.label }}
                <div class="form-group">
                    <div class="row">
                        <div class="col">
                            {{ form.post_date(class="datepicker form-control-lg form-control") }}
                        </div>
                        <div class="col">
                            {{ form.post_time(class="form-control-lg form-control") }}
                        </div>
                    </div>
                </div>

                {{ form.death_date.label }}
                <div class="form-group">
                    <div class="row">
                        <div class="col">
                            {{ form.death_date(class="datepicker form-control-lg form-control") }}
                        </div>
                        <div class="col">
                            {{ form.death_time(class="form-control-lg form-control") }}
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="row">
                        <div class="col">
                            {{ form.houses_available.label }}
                            {{ form.houses_available(size=4, multiple=True, class="form-control-lg form-control") }}
                        </div>
                        <div class="col">
                            {{ form.houses_assigned.label }}
                            {{ form.houses_assigned(size=4, multiple=True, class="form-control-lg form-control") }}
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    {{ form.body.label }}
                    {{ form.body(class="form-control-lg form-control", cols="15", rows="4") }}
                </div>

                <p style="color: orange;"> {{ message }} </p>

                {{ form.submit(type="submit", class="btn mt-3 rounded-pill btn-lg btn-custom btn-block text-uppercase") }}
           </form>
        </div>

        <div class="check-announcements">
            <h2 align="center"> Оповещения на сервере: </h2>
            <div class="list-group">
                {% for elem in announcements %}
                    <div class="list-group-item list-group-item-action" onclick="elem_expand('elem_{{ elem.id }}')">
                        <a href="/announcement/{{ elem.id }}"> <i class="fas fa-trash trash"></i> </a>
                        <a> <i class="fas fa-tools tools"></i> </a>
                        <b> ID: </b> {{ elem.id }}
                        <b> Заголовок: </b> {{ elem.title[:50] }}
                        <div id="elem_{{ elem.id }}">
                            <p> <b> Описание: </b> {{ elem.body }} </p>
                            <p> <b> Категория: </b> {{ elem.category.name }} </p>
                            <p>
                                <b> Дома: </b> [
                                    {% for i in range(elem.houses | length) %}
                                        {% if loop.last %}
                                            {{ elem.houses[i] }}
                                        {% else %}
                                            {{ elem.houses[i] }},
                                        {% endif %}
                                    {% endfor %}
                                    still not declared on server
                                ]
                            </p>
                            <p> <b> Статус: </b> {{ elem.status.name }} </p>
                            <div class="time-data">
                                {{ elem.postDate | replace("T", " ") | replace("+00:00", " ") }}
                                -
                                {{ elem.deathDate | replace("T", " ") | replace("+00:00", " ")}}
                            </div>
                        </div>
                    </div>
                    <script>
                        elem_expand('elem_{{ elem.id }}');
                    </script>
                {% endfor %}
            </div>
        </div>
    </div>

{% endblock %}